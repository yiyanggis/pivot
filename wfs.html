<!DOCTYPE html>
<html>
<head>
<link href="css/displayPhoto.css" rel="stylesheet">
<link href="css/bootstrap.css" rel="stylesheet">

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="geojsonhint.js"></script>
<script src="GJV.js"></script>

<script>

//$(document).ready(function(){
	/*$.ajax({
	  type: "POST",
	  url: "wfs.php",
	  data: {"lng":-113.31,"lat":49.59},
	  success: function(data){
	  	console.log(data);
	  },
	  done:function(data){
	  	console.log(data);
	  },
	  dataType: "json"
	});*/
	
	// $.post("wfs.php",{"lng":-113.31,"lat":49.59},function(data){
	// 	console.log(data);
	// 	var ul=$("#resultList");
	// 	$.each(data,function(index,value){
	// 		$('<li/>').text(value[0]+","+value[1]).appendTo(ul);
	// 	});
		

//});

var search_marker;
var result_markers=[];

 var customIcons = {
      restaurant: {
        icon: 'http://labs.google.com/ridefinder/images/mm_20_blue.png'
      },
      bar: {
        icon: 'http://labs.google.com/ridefinder/images/mm_20_red.png'
      }
    };

$(document).ready(function(){

	//service = new google.maps.places.PlacesService(map);

	

	function query(latLng){
		var lat=latLng.lat();
		var lng=latLng.lng();


		for (var i = 0; i<result_markers.length; i++) {
	      result_markers[i].setMap(null);
	    }

		$.post("wfs.php",{"lng":lng,"lat":lat},function(data){
			console.log(data);
			var ul=$("#resultList");
			ul.empty();
			$.each(data,function(index,value){
				var temp=new google.maps.Marker({
					position:new google.maps.LatLng(value[2],value[3]),
					map:map,
					icon:{
						url:"resources/plane.png",
						//url:customIcons.restaurant.icon,
						size: new google.maps.Size(144, 99),
						origin: new google.maps.Point(0, 0),
       					anchor: new google.maps.Point(12, 12),
        				scaledSize: new google.maps.Size(25, 25)
					},
					title:value[0]
				});


				result_markers.push(temp);
				$('<li/>').text(value[0]+","+value[1]+", type:"+value[4]).appendTo(ul);
			});
		});
	}

	var polygon1="{\"type\": \"Polygon\",\"coordinates\": [[[-98.662183210251,31.748662795865],[-98.661292716859,31.748279611375],[-98.661528751248,31.748005907196],[-98.66240851581,31.748343475567],[-98.662451431151,31.749064225536],[-98.661496564737,31.749091595678],[-98.660627529015,31.748553314744],[-98.661292716859,31.748480327258],[-98.661872074001,31.748754030034],[-98.662183210251,31.748662795865]]]}";

	var polygon2="{\"type\": \"Polygon\",\"coordinates\": [[[-98.666037,31.747699],[-98.6658,31.74801],[-98.665736,31.748249],[-98.665734,31.748745],[-98.665819,31.749039],[-98.666226,31.749315],[-98.66719,31.749555],[-98.667532,31.749831],[-98.667617,31.74996],[-98.667622,31.750261],[-98.667537,31.750518],[-98.667173,31.750794],[-98.667002,31.75085],[-98.666423,31.750943],[-98.665587,31.751],[-98.664751,31.750983],[-98.664151,31.751039],[-98.663915,31.751113],[-98.663722,31.751132],[-98.663444,31.751261],[-98.66325,31.751078],[-98.663207,31.750949],[-98.66325,31.750802],[-98.663421,31.750691],[-98.663785,31.750544],[-98.664149,31.750267],[-98.664125,31.750032],[-98.664119,31.750005],[-98.664081,31.749899],[-98.66391,31.749788],[-98.663332,31.749604],[-98.662925,31.749566],[-98.662496,31.749712],[-98.662324,31.749822],[-98.662091,31.750032],[-98.661041,31.750825],[-98.660892,31.750898],[-98.660549,31.750991],[-98.660399,31.750991],[-98.659819,31.750808],[-98.65954,31.750772],[-98.658875,31.750571],[-98.658596,31.750443],[-98.65836,31.75026],[-98.658274,31.750168],[-98.658205,31.750004],[-98.658166,31.749851],[-98.658296,31.749466],[-98.658639,31.749228],[-98.658854,31.749155],[-98.659154,31.749118],[-98.659625,31.749119],[-98.659818,31.749083],[-98.660269,31.748808],[-98.660548,31.748717],[-98.661019,31.748755],[-98.661384,31.748737],[-98.661705,31.748609],[-98.661856,31.748481],[-98.66235,31.747857],[-98.662909,31.747087],[-98.66336,31.746629],[-98.663425,31.7465],[-98.663318,31.74628],[-98.663211,31.746188],[-98.662847,31.74615],[-98.662397,31.746296],[-98.662118,31.746479],[-98.661774,31.746644],[-98.661539,31.746717],[-98.661281,31.746753],[-98.66096,31.746698],[-98.660853,31.746606],[-98.660768,31.746403],[-98.660877,31.745706],[-98.660835,31.745265],[-98.660664,31.745118],[-98.660192,31.745062],[-98.659935,31.745135],[-98.659806,31.745226],[-98.659634,31.745391],[-98.659419,31.745776],[-98.659204,31.745996],[-98.659097,31.74607],[-98.658818,31.746161],[-98.658582,31.746344],[-98.658517,31.746656],[-98.658581,31.746803],[-98.658644,31.747409],[-98.658579,31.747685],[-98.658407,31.74785],[-98.658192,31.747904],[-98.658064,31.747904],[-98.657807,31.747775],[-98.657614,31.747738],[-98.657292,31.747793],[-98.656627,31.748324],[-98.656434,31.748434],[-98.656262,31.748489],[-98.655962,31.748525],[-98.655426,31.748358],[-98.655255,31.748266],[-98.655084,31.748101],[-98.65502,31.747972],[-98.654979,31.747403],[-98.655237,31.746907],[-98.655217,31.746283],[-98.655282,31.746026],[-98.655454,31.745695],[-98.65597,31.745145],[-98.656142,31.744797],[-98.656164,31.744687],[-98.656078,31.744613],[-98.656035,31.744613],[-98.65552,31.745016],[-98.655005,31.745217],[-98.654791,31.745364],[-98.654533,31.745712],[-98.654446,31.746043],[-98.654209,31.746501],[-98.653822,31.746941],[-98.653136,31.747326],[-98.652278,31.747618],[-98.651591,31.747947],[-98.651141,31.748093],[-98.650733,31.748313],[-98.650604,31.748312],[-98.649146,31.748787],[-98.648953,31.748768],[-98.648761,31.748603],[-98.648718,31.748401],[-98.648761,31.748327],[-98.648783,31.748144],[-98.648999,31.747685],[-98.649063,31.74741],[-98.649021,31.747116],[-98.64885,31.746932],[-98.648657,31.746968],[-98.64855,31.747041],[-98.648227,31.7475],[-98.648076,31.748326],[-98.647968,31.74862],[-98.647688,31.749005],[-98.64743,31.749225],[-98.647259,31.749261],[-98.64698,31.74926],[-98.646509,31.749131],[-98.645632,31.748505],[-98.645246,31.748412],[-98.644946,31.748448],[-98.644474,31.748613],[-98.643981,31.748685],[-98.643767,31.748501],[-98.643682,31.748336],[-98.643385,31.746939],[-98.643558,31.746517],[-98.643751,31.746297],[-98.644416,31.745986],[-98.644695,31.745932],[-98.645745,31.745879],[-98.646989,31.745477],[-98.647311,31.745423],[-98.648683,31.745389],[-98.648961,31.745316],[-98.649174,31.746032],[-98.649281,31.746216],[-98.649366,31.746474],[-98.649429,31.746914],[-98.649599,31.747447],[-98.649984,31.747742],[-98.650241,31.747798],[-98.650563,31.747761],[-98.650842,31.74767],[-98.651164,31.747377],[-98.651443,31.747231],[-98.652258,31.747103],[-98.652622,31.747031],[-98.652815,31.746958],[-98.653073,31.746738],[-98.653052,31.746536],[-98.652282,31.745836],[-98.652175,31.745781],[-98.651961,31.745744],[-98.651746,31.745762],[-98.651575,31.745872],[-98.651317,31.746092],[-98.651166,31.746312],[-98.650544,31.746843],[-98.650351,31.74688],[-98.650265,31.746861],[-98.650115,31.746787],[-98.650094,31.746695],[-98.650266,31.746273],[-98.650503,31.745925],[-98.651319,31.745265],[-98.651663,31.744917],[-98.651749,31.744715],[-98.651794,31.743944],[-98.651858,31.743779],[-98.652116,31.743577],[-98.652438,31.743504],[-98.652867,31.74334],[-98.653189,31.74312],[-98.653683,31.742515],[-98.653877,31.742111],[-98.654156,31.741781],[-98.6545,31.741525],[-98.6548,31.74147],[-98.655679,31.741398],[-98.655893,31.741252],[-98.656087,31.740885],[-98.656195,31.740793],[-98.656302,31.74072],[-98.656516,31.740739],[-98.656751,31.740923],[-98.656944,31.741236],[-98.656986,31.741401],[-98.657264,31.741806],[-98.657349,31.742081],[-98.657326,31.742577],[-98.65739,31.742889],[-98.657496,31.743092],[-98.65786,31.743331],[-98.658332,31.743405],[-98.659382,31.743444],[-98.660174,31.743721],[-98.660538,31.74374],[-98.660667,31.743704],[-98.660903,31.743502],[-98.661204,31.743098],[-98.661312,31.743007],[-98.661483,31.742897],[-98.661698,31.742861],[-98.66204,31.743119],[-98.66236,31.743505],[-98.662639,31.743726],[-98.663067,31.743873],[-98.663453,31.743911],[-98.664202,31.744077],[-98.664437,31.74428],[-98.664843,31.744868],[-98.665421,31.745512],[-98.665442,31.745641],[-98.665377,31.745879],[-98.665162,31.746063],[-98.664175,31.746538],[-98.664089,31.746611],[-98.663853,31.746905],[-98.663766,31.747125],[-98.663787,31.74729],[-98.664001,31.747474],[-98.664344,31.747549],[-98.664773,31.747623],[-98.665823,31.74768],[-98.665908,31.747662],[-98.666037,31.747699]]]}";

	var polygon3="{\"type\": \"Polygon\",\"coordinates\": [[[-98.662183210251,31.748662795865],[-98.661292716859,31.748279611375],[-98.661528751248,31.748005907196],[-98.66240851581,31.748343475567],[-98.662451431151,31.749064225536],[-98.661496564737,31.749091595678],[-98.660627529015,31.748553314744],[-98.661292716859,31.748480327258],[-98.661872074001,31.748754030034],[-98.662183210251,31.748662795865]]]}";

	var polygon4="{\"type\": \"Polygon\",\"coordinates\": [[[-98.663444,31.751261],[-98.663423,31.751371],[-98.663124,31.751831],[-98.662524,31.752071],[-98.66231,31.75209],[-98.662074,31.752164],[-98.661217,31.752202],[-98.660531,31.752093],[-98.659501,31.752059],[-98.659158,31.752096],[-98.658902,31.752299],[-98.658795,31.752446],[-98.658731,31.752722],[-98.658754,31.753089],[-98.6594,31.754264],[-98.659465,31.754484],[-98.659639,31.755256],[-98.659554,31.755385],[-98.659425,31.755403],[-98.659081,31.755147],[-98.658909,31.754908],[-98.658737,31.754578],[-98.658348,31.753586],[-98.65809,31.753274],[-98.657981,31.752668],[-98.658001,31.75219],[-98.657935,31.751731],[-98.65787,31.751529],[-98.657676,31.751235],[-98.656816,31.750281],[-98.656694,31.750031],[-98.656684,31.750003],[-98.656623,31.749756],[-98.656367,31.74948],[-98.656152,31.749498],[-98.655874,31.749571],[-98.655424,31.749571],[-98.655124,31.749478],[-98.654931,31.749368],[-98.65401,31.749109],[-98.653346,31.749071],[-98.653196,31.749089],[-98.653088,31.74918],[-98.652789,31.748959],[-98.652575,31.748702],[-98.652597,31.74839],[-98.652683,31.748298],[-98.65292,31.748133],[-98.653756,31.747804],[-98.653906,31.747713],[-98.654764,31.747439],[-98.654979,31.747403],[-98.65502,31.747972],[-98.655084,31.748101],[-98.655255,31.748266],[-98.655426,31.748358],[-98.655962,31.748525],[-98.656262,31.748489],[-98.656434,31.748434],[-98.656627,31.748324],[-98.657292,31.747793],[-98.657614,31.747738],[-98.657807,31.747775],[-98.658064,31.747904],[-98.658192,31.747904],[-98.658407,31.74785],[-98.658579,31.747685],[-98.658644,31.747409],[-98.658581,31.746803],[-98.658517,31.746656],[-98.658582,31.746344],[-98.658818,31.746161],[-98.659097,31.74607],[-98.659204,31.745996],[-98.659419,31.745776],[-98.659634,31.745391],[-98.659806,31.745226],[-98.659935,31.745135],[-98.660192,31.745062],[-98.660664,31.745118],[-98.660835,31.745265],[-98.660877,31.745706],[-98.660768,31.746403],[-98.660853,31.746606],[-98.66096,31.746698],[-98.661281,31.746753],[-98.661539,31.746717],[-98.661774,31.746644],[-98.662118,31.746479],[-98.662397,31.746296],[-98.662847,31.74615],[-98.663211,31.746188],[-98.663318,31.74628],[-98.663425,31.7465],[-98.66336,31.746629],[-98.662909,31.747087],[-98.66235,31.747857],[-98.661856,31.748481],[-98.661705,31.748609],[-98.661384,31.748737],[-98.661019,31.748755],[-98.660548,31.748717],[-98.660269,31.748808],[-98.659818,31.749083],[-98.659625,31.749119],[-98.659154,31.749118],[-98.658854,31.749155],[-98.658639,31.749228],[-98.658296,31.749466],[-98.658166,31.749851],[-98.658205,31.750004],[-98.658274,31.750168],[-98.65836,31.75026],[-98.658596,31.750443],[-98.658875,31.750571],[-98.65954,31.750772],[-98.659819,31.750808],[-98.660399,31.750991],[-98.660549,31.750991],[-98.660892,31.750898],[-98.661041,31.750825],[-98.662091,31.750032],[-98.662324,31.749822],[-98.662496,31.749712],[-98.662925,31.749566],[-98.663332,31.749604],[-98.66391,31.749788],[-98.664081,31.749899],[-98.664119,31.750005],[-98.664125,31.750032],[-98.664149,31.750267],[-98.663785,31.750544],[-98.663421,31.750691],[-98.66325,31.750802],[-98.663207,31.750949],[-98.66325,31.751078],[-98.663444,31.751261]]]}";

	var complex_polygon_query="{\"type\":\"Polygon\",\"coordinates\":[[[-96.702049344363,41.5522394329481],[-96.7021514938557,41.5486982505355],[-96.6991721336528,41.5473532822153],[-96.6972483182074,41.5482045279876],[-96.6961076488726,41.5502985925874],[-96.6961076488726,41.5502985925874],[-96.702049344363,41.5522394329481]]]}";

	var complex_polygon="{\"type\": \"Polygon\",\"coordinates\": [[[-96.698317, 41.553515], [-96.698334, 41.553488], [-96.6983, 41.549235], [-96.698385, 41.546504], [-96.699673, 41.546514], [-96.700042, 41.546541], [-96.700051, 41.546568], [-96.700036, 41.548396], [-96.700023, 41.548479], [-96.699975, 41.548529], [-96.699843, 41.548553], [-96.699712, 41.548502], [-96.699277, 41.548056], [-96.698922, 41.547759], [-96.698518, 41.547547], [-96.698378, 41.547536], [-96.698358, 41.547572], [-96.698364, 41.54766], [-96.698864, 41.547953], [-96.699343, 41.548378], [-96.699583, 41.548559], [-96.699789, 41.548668], [-96.699907, 41.548896], [-96.699901, 41.549953], [-96.699819, 41.550276], [-96.699705, 41.551202], [-96.699643, 41.55187], [-96.69961, 41.552753], [-96.699771, 41.55276], [-96.699884, 41.552203], [-96.699897, 41.551795], [-96.699997, 41.551496], [-96.7, 41.551048], [-96.700043, 41.550896], [-96.700159, 41.550855], [-96.700533, 41.55087], [-96.701616, 41.550978], [-96.701693, 41.550929], [-96.701673, 41.550882], [-96.701582, 41.550844], [-96.700543, 41.550716], [-96.700144, 41.550731], [-96.700096, 41.55068], [-96.700138, 41.550091], [-96.700211, 41.549767], [-96.700223, 41.549385], [-96.700334, 41.549144], [-96.70038, 41.546613], [-96.700552, 41.546578], [-96.700578, 41.54653], [-96.700542, 41.546509], [-96.700642, 41.546497], [-96.702854, 41.54648], [-96.703085, 41.546499], [-96.703161, 41.546596], [-96.703107, 41.553589], [-96.703051, 41.553634], [-96.702854, 41.55366], [-96.70144, 41.553635], [-96.699704, 41.553548], [-96.699756, 41.553487], [-96.699764, 41.553419], [-96.699771, 41.552762], [-96.69961, 41.552755], [-96.699529, 41.553528], [-96.698317, 41.553515], [-96.698292, 41.553511], [-96.698254, 41.553539], [-96.697314, 41.553628], [-96.694752, 41.553608], [-96.694473, 41.553357], [-96.694246, 41.553253], [-96.693736, 41.553101], [-96.69366, 41.55314], [-96.693664, 41.553246], [-96.694342, 41.553437], [-96.694428, 41.553553], [-96.694545, 41.553606], [-96.693787, 41.553627], [-96.693681, 41.55357], [-96.693638, 41.552928], [-96.693634, 41.552172], [-96.693639, 41.548734], [-96.693644, 41.548307], [-96.693672, 41.548192], [-96.693738, 41.548234], [-96.694187, 41.548342], [-96.695065, 41.54833], [-96.69623, 41.54905], [-96.697084, 41.549839], [-96.697808, 41.550265], [-96.697968, 41.550403], [-96.697964, 41.550957], [-96.697838, 41.551029], [-96.697291, 41.551223], [-96.697131, 41.55134], [-96.697065, 41.551488], [-96.696267, 41.5514], [-96.696158, 41.551418], [-96.696126, 41.551458], [-96.696192, 41.551517], [-96.696919, 41.551592], [-96.697044, 41.551634], [-96.697087, 41.551673], [-96.697115, 41.551808], [-96.697226, 41.551985], [-96.697486, 41.552202], [-96.697565, 41.5522], [-96.697583, 41.552126], [-96.697231, 41.551676], [-96.697219, 41.551461], [-96.697354, 41.551323], [-96.697896, 41.551131], [-96.698072, 41.551035], [-96.698113, 41.550897], [-96.698144, 41.550432], [-96.698109, 41.550303], [-96.698052, 41.550226], [-96.697252, 41.549714], [-96.697059, 41.549548], [-96.696783, 41.549196], [-96.696665, 41.549101], [-96.696257, 41.548819], [-96.695224, 41.54822], [-96.695185, 41.548128], [-96.695173, 41.547829], [-96.694892, 41.547416], [-96.69485, 41.547221], [-96.694772, 41.547132], [-96.694671, 41.547127], [-96.694651, 41.547219], [-96.695012, 41.547865], [-96.695048, 41.548072], [-96.695013, 41.548171], [-96.694824, 41.548213], [-96.694335, 41.548239], [-96.69402, 41.548212], [-96.693744, 41.548127], [-96.693678, 41.548154], [-96.693641, 41.547374], [-96.693649, 41.546576], [-96.693683, 41.546495], [-96.697494, 41.546469], [-96.698333, 41.546483], [-96.698371, 41.54652], [-96.698334, 41.547504], [-96.697839, 41.547422], [-96.696647, 41.546922], [-96.695683, 41.546868], [-96.695597, 41.54688], [-96.695534, 41.546949], [-96.695546, 41.546995], [-96.695597, 41.547018], [-96.696152, 41.547019], [-96.696585, 41.54707], [-96.697665, 41.54753], [-96.697864, 41.547587], [-96.698293, 41.547639], [-96.698317, 41.547623], [-96.698318, 41.547513], [-96.698341, 41.547526], [-96.698288, 41.54941], [-96.698318, 41.553448], [-96.698292, 41.553511],[-96.698317, 41.553515]]]}";

	query2(polygon1,polygon2,function(ifprocess, result){
		console.log(ifprocess);
		console.log(result);
	});

	function query2(polygon1, polygon2, callback){
		var isGeoJson1=GJV.isGeoJSONObject(JSON.parse(polygon1));
		var isGeoJson2=GJV.isGeoJSONObject(JSON.parse(polygon2));

		if(isGeoJson2&&isGeoJson1){
			$.post("wfs2.php",{"polygon1":complex_polygon_query,"polygon2":complex_polygon},function(data){
				//console.log(data);
				callback(true,data);
			});
			
		}
		else{
			//return {"Please check if parameters are geojson format.";
			var error="geojson validation failed. Please check if parameters are geojson format";
			callback(false,error);
		}

	}

	function validateGeoJSON(feature){
		if(typeof(feature)=="string"){
			GJV.isGeoJSONObject(JSON.parse(feature), function(isGeoJson, errors){
				console.log(isGeoJson);
				console.log(errors);

				return isGeoJson;
			});
		}
		else{
			GJV.isGeoJSONObject(feature, function(isGeoJson, errors){
				console.log(isGeoJson);
				console.log(errors);

				return isGeoJson;
			});
		}
	}			
 });
</script>
</head>

<body>
	<div  class="palette">
		<div role="tabpanel">

		  <!-- Nav tabs -->
		  <ul class="nav nav-tabs" role="tablist">
		    <li role="presentation" class="active"><a href="#searchairport" aria-controls="images" role="tab" data-toggle="tab">search airport</a></li>
		    <li role="presentation"><a href="#layers" aria-controls="layers" role="tab" data-toggle="tab">todo</a></li>
		  </ul>

		  <!-- Tab panes -->
		  <div class="tab-content">



		    <div role="tabpanel" class="tab-pane active" id="searchairport">
		    	<h4>search result list</h4>
		    	<ul id="resultList">
		    	</ul>

				
		    </div>

		  </div>

		</div>
	</div>

	<div id="map"></div>
	<input id="pac-input" class="controls" type="text" placeholder="Enter a location">
	<!--<div id="panel" class="controls">

	</div>-->


	<div id="dialog" title="Dialog Title">
		<div id="panel2">

	</div>
	</div>

</body>
</html>